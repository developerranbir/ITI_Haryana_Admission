@model HigherEducation.Models.FeeViewModel

@{
    Layout = "~/Views/Shared/_LayoutSecond.cshtml";
}

@{
    Response.Cache.SetCacheability(HttpCacheability.NoCache);
    Response.Cache.SetExpires(DateTime.Now);
    Response.Buffer = true;

    Response.Expires = -1;
    Response.CacheControl = "no-cache";
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Change Password</title>
    <link href="../assets/css/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/assets/css/style.css">
    <link rel="stylesheet" href="~/assets/css/stylepayment.css">
    <link href="~/swalJs/sweetalert.css" rel="stylesheet" />
    <link href="~/swalJs/swal-forms.css" rel="stylesheet" />
    <script src="~/assets/js/jquery-ui/jquery-ui.min.js"></script>

    <script src="~/scripts/html2canvas.js"></script>
    <style>
        #footer {
            bottom: auto;
        }

        .loader,
        .outer-loader {
            display: inline-block;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0
        }

        .outer-loader {
            background: rgba(0, 0, 0, .3);
            width: 100%;
            height: 100%;
            z-index: 999
        }

        .loader {
            width: 69px;
            height: 89px;
            border: 1px solid #000;
            margin: auto
        }

        .loader-img {
            border: 15px solid #415bbb;
            border-radius: 50%;
            border-top: 15px solid #000;
            width: 80px;
            height: 80px;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite
        }

        @@-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0)
            }

            100% {
                -webkit-transform: rotate(360deg)
            }
        }

        @@keyframes spin {
            0% {
                transform: rotate(0)
            }

            100% {
                transform: rotate(360deg)
            }
        }

        .row_new {
            margin-left: 10px;
            margin-right: 10px
        }

        #logo img {
            height: auto;
            padding-left: 3px;
            width: 40px
        }

        body:not(.menu-on-top).desktop-detected {
            min-height: 907px !important
        }

        .table td {
            padding: 0.35rem;
            white-space: normal;
            word-wrap: break-word;
        }

        .cus-modal .modal-dialog {
            max-width: 800px !important;
        }

        .modal-content .close {
            position: absolute;
            right: -15px;
            background: #E91E63;
            width: 40px;
            height: 40px;
            z-index: 999;
            border-radius: 50%;
            color: #fff;
            font-size: 30px;
            top: -25px;
            cursor: pointer;
        }

        .cus-background .card {
            box-shadow: none !important;
            -webkit-box-shadow: none !important;
            -moz-box-shadow: none !important;
        }

        .cus-inner-data label {
            font-weight: 700 !important;
        }
        #footer {
            position: fixed;
            bottom: 0;
            right: 0;
        }
    </style>
</head>
<body>
    <div class="container-fluid">

        <div class="container">

            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <h3>Change Password</h3>

                    <h6><span style="color:#E91E63;font-weight:800;">Note:&nbsp;</span>Password must be between 6 and 15 characters; must contain at least one alphabet letter, one numeric digit, and one special character ($,# or @@)</h6>

                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-6 col-md-6 col-sm-12">
                        <div class="form-group">
                            <label for="txtOLDpwd">OLD Password</label>
                            <input name="txtOLDpwd" id="txtOLDpwd" type="password" placeholder="Enter OLD Password" class="textbox form-control" />
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12">
                        <div class="form-group">
                            <label for="txtnewpwd1">New Password</label>
                            <input name="txtnewpwd1" id="txtnewpwd1" type="password" placeholder="Enter New Password" class="textbox form-control" />
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12">
                        <div class="form-group">
                            <label for="txtnewpwd2">Confirm New Password</label>
                            <input name="txtnewpwd2" id="txtnewpwd2" type="password" placeholder="Confirm New Password" class="textbox form-control" />
                        </div>
                    </div>

                </div>

                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12">
                            <input type="button" id="update" value="Update" class="btn btn-success btn-sm" />
                            <input type="reset" id="btncancel" value="Cancel" class="btn btn-danger btn-sm" />

                        </div>
                    </div>
            </div>

        </div>
    </div>

    <script language="Javascript" type="text/javascript">
    $(document).ready(function () {
        $(document).on('click', '#update', function () {
            debugger;
            var pwd1 = document.getElementById("txtnewpwd1").value;
            var pwd2 = document.getElementById("txtnewpwd2").value;
            if (pwd1 == "") {
                alert("Please Enter New Password");
                document.getElementById("txtnewpwd1").focus();
                return false;
            }
            if (pwd2 == "") {
                alert("Please Enter Confirm New Password");
                document.getElementById("txtnewpwd2").focus();
                return false;
            }
            if (pwd1 != "") {
                if (pwd1 != pwd2) {
                    document.getElementById("txtnewpwd2").value = "";
                    alert("Confirm Password did not matched with New Password");
                    return false;
                }
            }

            //check for alphanumeric
		        var flag_num1 = 0;
		        var flag_alpha1 = 0;
		        var flag_spchars1 = 0;

		        for (i = 0; i < pwd1.length; i++) {
		            if ((pwd1.charAt(i) >= "0") && (pwd1.charAt(i) <= "9")) {
		                flag_num1 = flag_num1 + 1;
		            }
		            else if (((pwd1.charAt(i) >= "A") && (pwd1.charAt(i) <= "Z")) || ((pwd1.charAt(i) >= "a") && (pwd1.charAt(i) <= "z"))) {
		                flag_alpha1 = flag_alpha1 + 1;
		            }

		            else if ((pwd1.charAt(i) == "$") || (pwd1.charAt(i) == "#") || (pwd1.charAt(i) == "@@")) {
		                flag_spchars1 = flag_spchars1 + 1;
		            }

		        }

		        if (flag_num1 == 0) {
		            alert("Invalid new password");
                    document.getElementById("txtnewpwd1").focus();
		            return (false);
		        }

		        if (flag_alpha1 == 0) {
		            alert("Invalid new password");
                    document.getElementById("txtnewpwd1").focus();
		            return (false);
		        }

		        if (flag_spchars1 == 0) {
		            alert("Invalid new password");
                    document.getElementById("txtnewpwd1").focus();
		            return (false);
		        }
		        //check for alphanumeric

            if (pwd1.length <= 6 || pwd1.length >= 15) {
                swal("Error!", "Password Length must be between 6 to 15 Characters!", "error");
                return (false);
            }

        startPreloader();
            var datatosend = {};
            datatosend.pwd = pwd1;
            datatosend.DATA = JSON.stringify(datatosend);
        $.ajax({
            type: 'POST',
            url: "@Url.Action("changeCandidatePassword", "SecondYearLogin")",
            //contentType: 'application/json;charset=utf-8',
            dataType: 'json',
            data: datatosend,
            success: function (data) {
                console.log(data);
                stopPreloader();
                if (data == 1) {
                    //$('#btnFinalSave').hide();
                    swal({
                        title: "Done",
                        text: "Password Updated Successfully! Kindly Login again with new password",
                        type: "success"
                    }, function () {
                        window.location = "@Url.Action("Logout", "SecondYearLogin")"
                    });
                }
                else {
                    swal("Error!", "Some error is occured. Please try again!", "error");
                }

            },
            failure: function (data) {

                stopPreloader();
            },
            error: function (data) {
                alert(data.responseText);
                stopPreloader();
            }
        });


        });
    });

    </script>
    <script>
        function startPreloader() {
            $(".loader").css("display", "block");
            $(".outer-loader").css("display", "block");

        }
        function stopPreloader() {

            $(".loader").css("display", "none");
            $(".outer-loader").css("display", "none");
        }
    </script>
</body>
</html >